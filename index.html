<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orgena Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC4haY4VX-vgO03yA6Yj6hvsLw0EZav0Gk",
      authDomain: "orgenahub-7bca3.firebaseapp.com",
      projectId: "orgenahub-7bca3",
      storageBucket: "orgenahub-7bca3.firebasestorage.app",
      messagingSenderId: "807048048445",
      appId: "1:807048048445:web:48a2e965eee533a40e5f54",
      measurementId: "G-ZZRELPEM6J"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // DOM elements
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const postSection = document.getElementById('post-section');
    const projectsContainer = document.getElementById('projects');
    const titleInput = document.getElementById('title');
    const codeInput = document.getElementById('code');
    const postBtn = document.getElementById('postBtn');

    // User state
    let currentUser = null;

    // Auth state listener
    onAuthStateChanged(auth, user => {
      currentUser = user;
      updateUI();
      if (user) {
        loadProjects();
      }
    });

    // UI updates
    function updateUI() {
      if (currentUser) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        postSection.style.display = 'block';
      } else {
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        postSection.style.display = 'none';
      }
    }

    // Google Sign-In
    loginBtn.addEventListener('click', async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        console.log('User signed in:', result.user);
      } catch (error) {
        console.error('Error during sign-in:', error);
      }
    });

    // Sign out
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        console.log('User signed out');
      } catch (error) {
        console.error('Error during sign-out:', error);
      }
    });

    // Post project
    postBtn.addEventListener('click', async () => {
      const title = titleInput.value.trim();
      const code = codeInput.value.trim();
      if (title && code) {
        try {
          await addDoc(collection(db, 'projects'), {
            title,
            code,
            user: currentUser.displayName,
            stars: 0,
            comments: [],
            createdAt: new Date()
          });
          titleInput.value = '';
          codeInput.value = '';
        } catch (error) {
          console.error('Error adding document:', error);
        }
      } else {
        alert('Please provide both title and code.');
      }
    });

    // Load projects
    function loadProjects() {
      const q = query(collection(db, 'projects'), orderBy('createdAt', 'desc'), limit(10));
      onSnapshot(q, snapshot => {
        projectsContainer.innerHTML = '';
        snapshot.forEach(doc => {
          const project = doc.data();
          const projectElement = document.createElement('div');
          projectElement.className = 'project';
          projectElement.innerHTML = `
            <h3>${project.title}</h3>
            <pre class="code">${project.code}</pre>
            <div class="stars">
              <button class="star-btn">‚≠ê ${project.stars}</button>
            </div>
            <div class="comments">
              ${project.comments.map(comment => `<p><b>${comment.user}:</b> ${comment.text}</p>`).join('')}
            </div>
          `;
          projectsContainer.appendChild(projectElement);
        });
      });
    }
  </script>
  <style>
    /* Reset & body */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background: #f5f6fa; color: #333; }

    /* Header */
    header { background: #1abc9c; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { font-weight: 700; }
    header nav button { margin-left: 10px; padding: 8px 15px; border: none; border-radius: 5px; background: #16a085; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
    header nav button:hover { background: #149174; }

    /* Main layout */
    main { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
    #projects { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }

    /* Project card */
    .project { background: white; border-radius: 10px; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1); padding: 15px; display: flex; flex-direction: column; transition: 0.3s; }
    .project:hover { transform: translateY(-3px); }
    .project h3 { margin-bottom: 10px; color: #1abc9c; }
    .code { background: #2c3e50; color: #ecf0f1; padding: 10px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; overflow-x: auto; margin-bottom: 10px; }
    .stars, .comments { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 5px; }
    .star-btn { background: #e67e22; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
    .star-btn:hover { background: #cf711b; }
    .comment-input { flex: 1; padding: 6px; border-radius: 5px; border: 1px solid #ccc; }
    .comment-btn { padding: 6px 12px; background: #2980b9; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .comment-btn:hover { background: #1f5f8b; }
    .delete-btn { padding: 6px 12px; background: #c0392b; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .delete-btn:hover { background: #992d22; }

    /* Post section */
    #post-section { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }

    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 10px; min-width: 300px; max-width: 400px; display: flex; flex-direction: column; }
    .modal-content input { margin-bottom: 10px; }
    .modal-content button { margin-top: 5px; }

    /* Responsive */
    @media (max-width: 600px) {
      .stars, .comments, .actions { flex-direction: column; align-items: stretch; }
      .comment-btn { width: 100%; margin-top: 5px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Orgena Hub</h1>
    <nav>
      <button id="loginBtn">Login/Register</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </nav>
  </header>

  <main>
    <div id="post-section" style="display:none;">
      <h2>Post Your Orgena Code</h2>
      <input id="title" placeholder="Project Title">
      <textarea id="code" rows="6" placeholder="Paste your Orgena code here"></textarea>
      <button id="postBtn">Post Project</button>
    </div>

    <h2>All Projects</h2>
    <div id="projects"></div>
  </main>
</body>
</html>
